#                             '"request_id":"$request_id",' はないらしい
log_format json '{'
                   '"time":"$time_local",'
                   '"host":"$remote_addr",'
                   '"forwardedfor":"$http_x_forwarded_for",'
                   '"req":"$request",'
                   '"status":"$status",'
                   '"method":"$request_method",'
                   '"uri":"$request_uri",'
                   '"body_bytes":$body_bytes_sent,'
                   '"referer":"$http_referer",'
                   '"ua":"$http_user_agent",'
                   '"request_time":$request_time,'
                   '"cache":"$upstream_http_x_cache",'
                   '"runtime":"$upstream_http_x_runtime",'
                   '"response_time":"$upstream_response_time",'
                   '"vhost":"$host"'
                 '}';

server {
        listen 80 default_server;
        listen [::]:80 default_server;
        server_name isubata.example.com;

        client_max_body_size 20M;

        access_log /var/log/nginx/access.log json;

        root /home/isucon/isucon7-qualify/webapp/public;

        location /favicon.ico { }
        location /fonts/ { }
        location /js/ { }
        location /css/ { }

        location /icons/ {
            alias /home/isucon/isucon7-qualify/webapp/public/icons/;
            expires 30d;  # クライアントに30日間キャッシュさせる
            add_header Cache-Control "public, max-age=2592000";  # 30日間のキャッシュを指示
        }

        location / {
                proxy_set_header Host $http_host;
                proxy_pass http://127.0.0.1:5000;
        }
}
